{"version":3,"file":"getLastByCategory-B4PkROOz.js","sources":["../../src/components/LocalDate.tsx","../../src/components/PostCards/PostCardMeta.tsx","../../src/components/PostCards/Card3.tsx","../../src/components/latest.tsx","../../src/query/post/getLastByCategory.ts"],"sourcesContent":["import { FC } from 'react'\n\ninterface Props {\n  date: string\n  className?: string\n  vr?: 'ar' | 'fr'\n}\n\nconst LocalDate: FC<Props> = ({ date, className, vr }) => {\n  const d = new Date(date)\n  const now = new Date()\n\n  const diff = (d.getTime() - now.getTime()) / 1000 - 3600 // in seconds\n  // console.log('post ' + d)\n  // console.log('now ' + now)\n  // console.log(diff)\n  const rtf = new Intl.RelativeTimeFormat(vr, { numeric: 'auto' })\n\n  let value: number\n  let unit: Intl.RelativeTimeFormatUnit\n\n  const absDiff = Math.abs(diff)\n\n  if (absDiff < 60) {\n    value = Math.round(diff)\n    unit = 'second'\n  } else if (absDiff < 3600) {\n    value = Math.round(diff / 60)\n    unit = 'minute'\n  } else if (absDiff < 86400) {\n    value = Math.round(diff / 3600)\n    unit = 'hour'\n  } else if (absDiff < 2592000) {\n    value = Math.round(diff / 86400)\n    unit = 'day'\n  } else if (absDiff < 31536000) {\n    value = Math.round(diff / 2592000)\n    unit = 'month'\n  } else {\n    value = Math.round(diff / 31536000)\n    unit = 'year'\n  }\n\n  return (\n    <time dateTime={date} className={className}>\n      {rtf.format(value, unit).replace(/^قبل\\s/, 'منذ ')}\n    </time>\n  )\n}\n\nexport default LocalDate\n","import { TPost } from '@/types'\nimport clsx from 'clsx'\nimport { FC } from 'react'\nimport LocalDate from '../LocalDate'\n\ninterface Props {\n  className?: string\n  meta: Pick<TPost, 'date'>\n  hiddenAvatar?: boolean\n  avatarSize?: string\n  vr: 'ar' | 'fr'\n}\n\nconst PostCardMeta: FC<Props> = ({ className, meta, vr }) => {\n  const { date } = meta\n\n  return (\n    <div\n      className={clsx(\n        'post-card-meta flex flex-wrap items-center text-xs/6',\n        className,\n      )}\n    >\n      <span className=\"font-normal text-neutral-500 dark:text-neutral-400\">\n        <LocalDate date={date} vr={vr} />\n      </span>\n    </div>\n  )\n}\n\nexport default PostCardMeta\n","import PostCardMeta from './PostCardMeta'\nimport { TPost } from '@/types'\nimport clsx from 'clsx'\nimport Image from '../image'\nimport { Link } from '@tanstack/react-router'\nimport { FC, useRef, useState } from 'react'\nimport CategoryBadgeList from './CategoryBadgeList'\nimport PostCardSaveBtn from './PostCardSaveBtn'\nimport PostTypeFeaturedIcon from './PostTypeFeaturedIcon'\nimport MediaVideo from './MediaVideo'\nimport _ from 'lodash'\nimport { useIsPWA } from '@/hooks/useIsPWA'\n\ninterface Props {\n  className?: string\n  post: TPost\n  vr: 'ar' | 'fr'\n}\n\nconst Card3: FC<Props> = ({ className, post, vr }) => {\n  const {\n    title,\n    handle,\n    featuredImage,\n    excerpt,\n    categories,\n    postType,\n    id,\n    videoUrl,\n    short_link,\n  } = post\n\n  const path = vr === 'fr' ? '/news/fr/$postId' : '/news/$postId'\n  const link = decodeURIComponent(handle)\n  const [isHover, setIsHover] = useState(false)\n  const cardRef = useRef<HTMLDivElement>(null)\n  const isPWA = useIsPWA()\n\n  // useEffect(() => {\n  //   const handleMouseMove = (e: MouseEvent) => {\n  //     if (cardRef.current) {\n  //       const isInside = cardRef.current.contains(e.target as Node)\n  //       setIsHover(isInside)\n  //     }\n  //   }\n\n  //   document.addEventListener('mousemove', handleMouseMove)\n  //   return () => {\n  //     document.removeEventListener('mousemove', handleMouseMove)\n  //   }\n  // }, [])\n  const showImage =\n    !!featuredImage.src &&\n    !featuredImage.src.includes('placehold') &&\n    !featuredImage.src.includes('/default-')\n  return (\n    <div\n      ref={cardRef}\n      className={clsx(\n        'group post-card-3 flex flex-wrap items-center gap-x-7 gap-y-5 sm:flex-nowrap ',\n        className,\n      )}\n    >\n      <div\n        className={clsx(\n          'overflow-hidden relative aspect-16/9 sm:aspect-1/1 w-full  sm:w-56 shrink-0 rounded-2xl shadow-lg transition-shadow shadow-black/30',\n          !showImage && 'hidden sm:block',\n        )}\n      >\n        <Image\n          src={featuredImage}\n          alt={title}\n          className=\"w-full rounded-2xl  object-cover brightness-100 transition-[filter] duration-300 group-hover:brightness-75\"\n          fill\n        />\n\n        {!isHover && videoUrl && (\n          <PostTypeFeaturedIcon\n            onClick={() => setIsHover(!isHover)}\n            className=\"absolute z-30 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 hover:bg-accent-foreground rounded-full cursor-pointer\"\n            postType={postType}\n            wrapSize=\"size-12\"\n            iconSize=\"size-7\"\n          />\n        )}\n        {videoUrl && (\n          <MediaVideo\n            setIsHover={() => setIsHover(!isHover)}\n            isHover={isHover}\n            videoUrl={videoUrl}\n            handle={handle}\n            vr={vr}\n          />\n        )}\n\n        <Link\n          aria-label={post.title}\n          to={path}\n          params={{ postId: link }}\n          search={{ id: id }}\n          {...(!isPWA && {\n            target: '_blank',\n          })}\n          className=\"absolute inset-0\"\n        ></Link>\n      </div>\n\n      <div className=\"flex grow flex-col\">\n        <div className=\"space-y-3.5\">\n          <div className=\"flex items-center gap-2\">\n            <CategoryBadgeList categories={categories} vr={vr} />\n\n            <PostCardSaveBtn\n              key={id}\n              handle={short_link}\n              className=\"ms-auto\"\n              vr={vr}\n            />\n            {/*<PostCardMeta meta={post} />*/}\n          </div>\n\n          <h2 className=\"nc-card-title block text-base font-medium sm:font-semibold xl:text-lg\">\n            <Link\n              aria-label={post.title}\n              to={path}\n              params={{ postId: link }}\n              search={{ id: id }}\n              className=\"line-clamp-2\"\n              title={title}\n              dangerouslySetInnerHTML={{ __html: title }}\n            >\n              {/*{title*/}\n            </Link>\n          </h2>\n          <p\n            className=\"line-clamp-3 text-sm/6 text-neutral-600 dark:text-neutral-400\"\n            // dangerouslySetInnerHTML={{ __html: excerpt }}\n          >\n            {excerpt}\n          </p>\n        </div>\n        <div className=\"py-1\">\n          <PostCardMeta meta={post} vr={vr} />\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default Card3\n","import Heading from '@/shared/Heading'\nimport { TPost } from '@/types'\n// import { ArrowRightIcon } from '@hugeicons/core-free-icons'\nimport clsx from 'clsx'\nimport Card3 from './PostCards/Card3'\nimport { Link } from '@tanstack/react-router'\nimport { ChevronRight, ChevronLeft } from 'lucide-react'\nimport { useOnline } from '@/hooks/use-online'\nimport NoInternet from './NoInternet'\n\nconst Latest = ({\n  posts,\n  heading,\n  vr,\n  loading,\n  linkto,\n}: {\n  posts: TPost[]\n  heading?: string\n  vr: 'ar' | 'fr'\n  loading?: boolean\n  linkto?: string\n}) => {\n  const renderCard = (post: TPost, index: number) => {\n    return <Card3 key={index} className=\"py-1\" post={post} vr={vr} />\n  }\n  const { isOnline, checkConnection } = useOnline()\n\n  const path = vr === 'fr' ? '/news/fr/$postId' : '/news/$postId'\n  const link =\n    linkto ??\n    (vr === 'fr'\n      ? 'dernieres-actualites'\n      : decodeURIComponent(\n          '%D8%A2%D8%AE%D8%B1-%D8%A7%D9%84%D8%A3%D8%AE%D8%A8%D8%A7%D8%B1',\n        ))\n\n  if (loading)\n    return (\n      <div className=\"pt-4\">\n        {' '}\n        <div className=\"space-y-6 lg:col-span-2\">\n          {Array.from({ length: 8 }).map((_, i) => (\n            <div key={i} className=\"flex gap-4\">\n              <div className=\"h-50 w-56 rounded-lg bg-gray-300\"></div>\n              <div className=\"flex-1 space-y-2\">\n                <div className=\"h-4 w-3/4 rounded bg-gray-200\"></div>\n                <div className=\"h-4 w-full rounded bg-gray-200\"></div>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n    )\n\n  if (posts.length == 0) {\n    checkConnection()\n    return (\n      <div className=\"w-full lg:w-3/5 xl:w-2/3 xl:pe-20 mx-auto\">\n        {!isOnline && (\n          <NoInternet\n            isFr={vr === 'fr'}\n            isOnline={isOnline}\n            onRetry={() => window.location.reload()}\n            checkConnection={checkConnection}\n          />\n        )}\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"pt-4\">\n      {!!heading && (\n        <Heading level={2}>\n          <Link\n            to={path}\n            params={{ postId: link }}\n            className=\"flex items-center space-x-4 \"\n          >\n            {heading}\n            {vr === 'fr' ? (\n              <ChevronRight size={19} strokeWidth={3} className=\"mt-1\" />\n            ) : (\n              <ChevronLeft size={19} strokeWidth={3} className=\"mt-1\" />\n            )}{' '}\n          </Link>\n        </Heading>\n      )}\n      <div className={clsx('grid gap-6 md:gap-7')}>{posts.map(renderCard)}</div>\n    </div>\n  )\n}\n\nexport default Latest\n","import { shuffle } from '@/config'\nimport { originToUsable, TUnPost } from '@/data/posts'\nimport { TPost } from '@/types'\nimport { useQuery } from '@tanstack/react-query'\n\nconst api = import.meta.env.VITE_API_NEWS\n\nexport const useGetPostByCat = (\n  cat?: number,\n  page?: string,\n  rand?: boolean,\n) => {\n  const query = useQuery({\n    enabled: !!cat,\n    staleTime: 1000 * 600,\n    queryKey: ['cat', { cat, page, rand: !!rand }],\n    queryFn: async () => {\n      const response = await fetch(`${api}/categorie/${cat}?p=${page}`)\n\n      if (!response.ok) {\n        throw new Error('faild to fetch posts')\n      }\n\n      const { results: unformatedPosts, total }: categorieResponse =\n        await response.json()\n\n      const beforeRandPosts: TPost[] = unformatedPosts.map((post) =>\n        originToUsable(post),\n      )\n\n      const posts = rand ? shuffle(beforeRandPosts) : beforeRandPosts\n      // const posts = beforeRandPosts\n      // console.log(posts)\n      return { posts, total }\n    },\n  })\n  return query\n}\n\nexport interface categorieResponse {\n  page: number\n  pageSize: number\n  total: number\n  results: TUnPost[]\n}\n"],"names":["LocalDate","date","className","vr","d","now","diff","rtf","value","unit","absDiff","jsx","PostCardMeta","meta","clsx","Card3","post","title","handle","featuredImage","excerpt","categories","postType","id","videoUrl","short_link","path","link","isHover","setIsHover","useState","cardRef","useRef","isPWA","useIsPWA","showImage","jsxs","Image","PostTypeFeaturedIcon","MediaVideo","Link","CategoryBadgeList","PostCardSaveBtn","Latest","posts","heading","loading","linkto","renderCard","index","isOnline","checkConnection","useOnline","_","i","NoInternet","Heading","ChevronRight","ChevronLeft","api","useGetPostByCat","cat","page","rand","useQuery","response","unformatedPosts","total","beforeRandPosts","originToUsable","shuffle"],"mappings":"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"}