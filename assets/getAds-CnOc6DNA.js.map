{"version":3,"file":"getAds-CnOc6DNA.js","sources":["../../src/query/post/getAds.ts"],"sourcesContent":["import { useQuery } from '@tanstack/react-query'\n\ntype AdvertItem = {\n  id: string\n  Id_CmsInscription: string\n  owner_id: string\n  Sujet: string\n  title: string\n  description: string\n  Text: string\n  classe: string\n  classe_slug: string\n  category: string\n  Price: number | null\n  image: string\n  Video: string\n  LinkToshop: string\n  ShowCallAdvertiserLink: number\n  ShowOrderLink: number\n  ShowSendMessageLink: number\n  ShowLink: number\n  LinkLabel: string | null\n  Annonceur: string\n  NbVisite: number\n  characteristics: any[]\n}\n\nexport type AdPreview = {\n  id: string\n  title: string\n  image: string\n  link: string\n\n  Video?: string\n}\n\nconst API_BASE = 'https://betaapiw.fibladi.com/api/ads/feed'\n\nexport const fetchAdsFeed = async (limit: number): Promise<AdPreview[]> => {\n  const res = await fetch(`${API_BASE}${limit > 1 ? '?limit=' + limit : ''}`)\n  if (!res.ok) {\n    throw new Error('Failed to fetch ads feed')\n  }\n  const json: AdvertItem[] = await res.json()\n\n  return json.map((ad) => ({\n    id: ad.id,\n    title: ad.title,\n    image: ad.image,\n    link: ad.LinkToshop,\n\n    Video: getEmbedUrl(ad.Video)!,\n  }))\n}\n\nexport const useAdsFeed = (limit: number) => {\n  return useQuery<AdPreview[], Error>({\n    queryKey: ['adsFeed', limit],\n    queryFn: () => fetchAdsFeed(limit),\n    staleTime: 1000 * 60 * 20, // 2 minutes\n  })\n}\n\nfunction getEmbedUrl(url: string) {\n  if (!url) return null\n\n  // YouTube\n  if (url.includes('youtube.com') || url.includes('youtu.be')) {\n    const id = url.includes('youtu.be')\n      ? url.split('/').pop()\n      : new URL(url).searchParams.get('v')\n    return `https://www.youtube.com/embed/${id}`\n  }\n\n  // Instagram\n  if (url.includes('instagram.com')) {\n    return `${url.split('?')[0]}embed`\n  }\n\n  // // Facebook\n  // if (url.includes('facebook.com')) {\n  //   if (url.includes('/share/') || url.includes('/profile')) {\n  //     return null\n  //   }\n  //   return `https://www.facebook.com/plugins/video.php?href=${encodeURIComponent(\n  //     url,\n  //   )}&show_text=false`\n  // }\n\n  return null\n}\n"],"names":["API_BASE","fetchAdsFeed","limit","res","ad","getEmbedUrl","useAdsFeed","useQuery","url"],"mappings":"+CAoCA,MAAMA,EAAW,4CAEJC,EAAe,MAAOC,GAAwC,CACzE,MAAMC,EAAM,MAAM,MAAM,GAAGH,CAAQ,GAAGE,EAAQ,EAAI,UAAYA,EAAQ,EAAE,EAAE,EAC1E,GAAI,CAACC,EAAI,GACP,MAAM,IAAI,MAAM,0BAA0B,EAI5C,OAF2B,MAAMA,EAAI,KAAA,GAEzB,IAAKC,IAAQ,CACvB,GAAIA,EAAG,GACP,MAAOA,EAAG,MACV,MAAOA,EAAG,MACV,KAAMA,EAAG,WAET,MAAOC,EAAYD,EAAG,KAAK,CAAA,EAC3B,CACJ,EAEaE,EAAcJ,GAClBK,EAA6B,CAClC,SAAU,CAAC,UAAWL,CAAK,EAC3B,QAAS,IAAMD,EAAaC,CAAK,EACjC,UAAW,IAAO,GAAK,EAAA,CACxB,EAGH,SAASG,EAAYG,EAAa,CAChC,OAAKA,EAGDA,EAAI,SAAS,aAAa,GAAKA,EAAI,SAAS,UAAU,EAIjD,iCAHIA,EAAI,SAAS,UAAU,EAC9BA,EAAI,MAAM,GAAG,EAAE,IAAA,EACf,IAAI,IAAIA,CAAG,EAAE,aAAa,IAAI,GAAG,CACK,GAIxCA,EAAI,SAAS,eAAe,EACvB,GAAGA,EAAI,MAAM,GAAG,EAAE,CAAC,CAAC,QAatB,KAzBU,IA0BnB"}